<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 Working with Data | R Programming for Data Sciences</title>
  <meta name="description" content="Chapter 6 Working with Data | R Programming for Data Sciences" />
  <meta name="generator" content="bookdown 0.10 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 Working with Data | R Programming for Data Sciences" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 Working with Data | R Programming for Data Sciences" />
  
  
  

<meta name="author" content="Andrew O. Finley, Vince Melfi, Jeffrey W. Doser" />


<meta name="date" content="2019-05-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="graphics-in-r.html">
<link rel="next" href="functions-and-programming.html">
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Course Description</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html"><i class="fa fa-check"></i><b>2</b> Introduction to R and RStudio</a><ul>
<li class="chapter" data-level="2.1" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#obtaining-and-installing-r"><i class="fa fa-check"></i><b>2.1</b> Obtaining and Installing R</a></li>
<li class="chapter" data-level="2.2" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#obtaining-and-installing-rstudio"><i class="fa fa-check"></i><b>2.2</b> Obtaining and Installing RStudio</a></li>
<li class="chapter" data-level="2.3" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#using-r-and-rstudio"><i class="fa fa-check"></i><b>2.3</b> Using R and RStudio</a><ul>
<li class="chapter" data-level="2.3.1" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#r-as-a-calculator"><i class="fa fa-check"></i><b>2.3.1</b> R as a Calculator</a></li>
<li class="chapter" data-level="2.3.2" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#dec"><i class="fa fa-check"></i><b>2.3.2</b> Basic descriptive statistics and graphics in R</a></li>
<li class="chapter" data-level="2.3.3" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#an-initial-tour-of-rstudio"><i class="fa fa-check"></i><b>2.3.3</b> An Initial Tour of RStudio</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#getting-help"><i class="fa fa-check"></i><b>2.4</b> Getting Help</a></li>
<li class="chapter" data-level="2.5" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#workspace-working-directory-and-keeping-organized"><i class="fa fa-check"></i><b>2.5</b> Workspace, Working Directory, and Keeping Organized</a></li>
<li class="chapter" data-level="2.6" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#quality-of-r-code"><i class="fa fa-check"></i><b>2.6</b> Quality of R code</a><ul>
<li class="chapter" data-level="2.6.1" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#naming-files"><i class="fa fa-check"></i><b>2.6.1</b> Naming Files</a></li>
<li class="chapter" data-level="2.6.2" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#naming-variables"><i class="fa fa-check"></i><b>2.6.2</b> Naming Variables</a></li>
<li class="chapter" data-level="2.6.3" data-path="introduction-to-r-and-rstudio.html"><a href="introduction-to-r-and-rstudio.html#syntax"><i class="fa fa-check"></i><b>2.6.3</b> Syntax</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="scripts-and-r-markdown.html"><a href="scripts-and-r-markdown.html"><i class="fa fa-check"></i><b>3</b> Scripts and R Markdown</a><ul>
<li class="chapter" data-level="3.1" data-path="scripts-and-r-markdown.html"><a href="scripts-and-r-markdown.html#scripts-in-r"><i class="fa fa-check"></i><b>3.1</b> Scripts in R</a></li>
<li class="chapter" data-level="3.2" data-path="scripts-and-r-markdown.html"><a href="scripts-and-r-markdown.html#r-markdown"><i class="fa fa-check"></i><b>3.2</b> R Markdown</a><ul>
<li class="chapter" data-level="3.2.1" data-path="scripts-and-r-markdown.html"><a href="scripts-and-r-markdown.html#creating-and-processing-r-markdown-documents"><i class="fa fa-check"></i><b>3.2.1</b> Creating and Processing R Markdown Documents</a></li>
<li class="chapter" data-level="3.2.2" data-path="scripts-and-r-markdown.html"><a href="scripts-and-r-markdown.html#output-formats-other-than-html"><i class="fa fa-check"></i><b>3.2.2</b> Output Formats other than HTML</a></li>
<li class="chapter" data-level="3.2.3" data-path="scripts-and-r-markdown.html"><a href="scripts-and-r-markdown.html#latex-knitr-and-bookdown"><i class="fa fa-check"></i><b>3.2.3</b> LaTeX, <code>knitr</code>, and <code>bookdown</code></a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="scripts-and-r-markdown.html"><a href="scripts-and-r-markdown.html#practice-exercises"><i class="fa fa-check"></i><b>3.3</b> Practice Exercises</a></li>
<li class="chapter" data-level="3.4" data-path="scripts-and-r-markdown.html"><a href="scripts-and-r-markdown.html#homework"><i class="fa fa-check"></i><b>3.4</b> Homework</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="structures.html"><a href="structures.html"><i class="fa fa-check"></i><b>4</b> Data Structures</a><ul>
<li class="chapter" data-level="4.1" data-path="structures.html"><a href="structures.html#vector"><i class="fa fa-check"></i><b>4.1</b> Vectors</a><ul>
<li class="chapter" data-level="4.1.1" data-path="structures.html"><a href="structures.html#types-conversion-coercion"><i class="fa fa-check"></i><b>4.1.1</b> Types, Conversion, Coercion</a></li>
<li class="chapter" data-level="4.1.2" data-path="structures.html"><a href="structures.html#accessing-specific-elements-of-vectors"><i class="fa fa-check"></i><b>4.1.2</b> Accessing Specific Elements of Vectors</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="structures.html"><a href="structures.html#factors"><i class="fa fa-check"></i><b>4.2</b> Factors</a></li>
<li class="chapter" data-level="4.3" data-path="structures.html"><a href="structures.html#names-of-objects-in-r"><i class="fa fa-check"></i><b>4.3</b> Names of Objects in R</a></li>
<li class="chapter" data-level="4.4" data-path="structures.html"><a href="structures.html#missing-data-infinity-etc."><i class="fa fa-check"></i><b>4.4</b> Missing Data, Infinity, etc.</a><ul>
<li class="chapter" data-level="4.4.1" data-path="structures.html"><a href="structures.html#infinity-and-nan"><i class="fa fa-check"></i><b>4.4.1</b> Infinity and NaN</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="structures.html"><a href="structures.html#dataFrames"><i class="fa fa-check"></i><b>4.5</b> Data Frames</a><ul>
<li class="chapter" data-level="4.5.1" data-path="structures.html"><a href="structures.html#accessing-specific-elements-of-data-frames"><i class="fa fa-check"></i><b>4.5.1</b> Accessing Specific Elements of Data Frames</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="structures.html"><a href="structures.html#lists"><i class="fa fa-check"></i><b>4.6</b> Lists</a><ul>
<li class="chapter" data-level="4.6.1" data-path="structures.html"><a href="structures.html#accessing-specific-elements-of-lists"><i class="fa fa-check"></i><b>4.6.1</b> Accessing Specific Elements of Lists</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="structures.html"><a href="structures.html#subsetting"><i class="fa fa-check"></i><b>4.7</b> Subsetting with Logical Vectors</a><ul>
<li class="chapter" data-level="4.7.1" data-path="structures.html"><a href="structures.html#modifying-or-creating-objects-via-subsetting"><i class="fa fa-check"></i><b>4.7.1</b> Modifying or Creating Objects via Subsetting</a></li>
<li class="chapter" data-level="4.7.2" data-path="structures.html"><a href="structures.html#logical-subsetting-and-data-frames"><i class="fa fa-check"></i><b>4.7.2</b> Logical Subsetting and Data Frames</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="structures.html"><a href="structures.html#patterned-data"><i class="fa fa-check"></i><b>4.8</b> Patterned Data</a></li>
<li class="chapter" data-level="4.9" data-path="structures.html"><a href="structures.html#practice-exercises-1"><i class="fa fa-check"></i><b>4.9</b> Practice Exercises</a></li>
<li class="chapter" data-level="4.10" data-path="structures.html"><a href="structures.html#homework-1"><i class="fa fa-check"></i><b>4.10</b> Homework</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="graphics-in-r.html"><a href="graphics-in-r.html"><i class="fa fa-check"></i><b>5</b> Graphics in R</a><ul>
<li class="chapter" data-level="5.1" data-path="graphics-in-r.html"><a href="graphics-in-r.html#scatter-plots"><i class="fa fa-check"></i><b>5.1</b> Scatter Plots</a><ul>
<li class="chapter" data-level="5.1.1" data-path="graphics-in-r.html"><a href="graphics-in-r.html#structure-of-a-typical-ggplot"><i class="fa fa-check"></i><b>5.1.1</b> Structure of a Typical <code>ggplot</code></a></li>
<li class="chapter" data-level="5.1.2" data-path="graphics-in-r.html"><a href="graphics-in-r.html#adding-lines-to-a-scatter-plot"><i class="fa fa-check"></i><b>5.1.2</b> Adding lines to a scatter plot</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="graphics-in-r.html"><a href="graphics-in-r.html#labels-axes-text-etc."><i class="fa fa-check"></i><b>5.2</b> Labels, Axes, Text, etc.</a><ul>
<li class="chapter" data-level="5.2.1" data-path="graphics-in-r.html"><a href="graphics-in-r.html#labels"><i class="fa fa-check"></i><b>5.2.1</b> Labels</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="graphics-in-r.html"><a href="graphics-in-r.html#customizing-axes"><i class="fa fa-check"></i><b>5.3</b> Customizing Axes</a><ul>
<li class="chapter" data-level="5.3.1" data-path="graphics-in-r.html"><a href="graphics-in-r.html#text-point-size-and-color"><i class="fa fa-check"></i><b>5.3.1</b> Text, Point Size, and Color</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="graphics-in-r.html"><a href="graphics-in-r.html#other-types-of-graphics"><i class="fa fa-check"></i><b>5.4</b> Other Types of Graphics</a><ul>
<li class="chapter" data-level="5.4.1" data-path="graphics-in-r.html"><a href="graphics-in-r.html#histograms"><i class="fa fa-check"></i><b>5.4.1</b> Histograms</a></li>
<li class="chapter" data-level="5.4.2" data-path="graphics-in-r.html"><a href="graphics-in-r.html#boxplots"><i class="fa fa-check"></i><b>5.4.2</b> Boxplots</a></li>
<li class="chapter" data-level="5.4.3" data-path="graphics-in-r.html"><a href="graphics-in-r.html#bar-graphs"><i class="fa fa-check"></i><b>5.4.3</b> Bar Graphs</a></li>
<li class="chapter" data-level="5.4.4" data-path="graphics-in-r.html"><a href="graphics-in-r.html#graphs-of-functions"><i class="fa fa-check"></i><b>5.4.4</b> Graphs of Functions</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="graphics-in-r.html"><a href="graphics-in-r.html#themes"><i class="fa fa-check"></i><b>5.5</b> Themes</a></li>
<li class="chapter" data-level="5.6" data-path="graphics-in-r.html"><a href="graphics-in-r.html#saving-graphics"><i class="fa fa-check"></i><b>5.6</b> Saving Graphics</a></li>
<li class="chapter" data-level="5.7" data-path="graphics-in-r.html"><a href="graphics-in-r.html#more-resources"><i class="fa fa-check"></i><b>5.7</b> More Resources</a></li>
<li class="chapter" data-level="5.8" data-path="graphics-in-r.html"><a href="graphics-in-r.html#practice-exercises-2"><i class="fa fa-check"></i><b>5.8</b> Practice Exercises</a></li>
<li class="chapter" data-level="5.9" data-path="graphics-in-r.html"><a href="graphics-in-r.html#homework-2"><i class="fa fa-check"></i><b>5.9</b> Homework</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="data2.html"><a href="data2.html"><i class="fa fa-check"></i><b>6</b> Working with Data</a><ul>
<li class="chapter" data-level="6.1" data-path="data2.html"><a href="data2.html#reading-data-into-r"><i class="fa fa-check"></i><b>6.1</b> Reading Data into R</a></li>
<li class="chapter" data-level="6.2" data-path="data2.html"><a href="data2.html#reading-data-with-missing-observations"><i class="fa fa-check"></i><b>6.2</b> Reading Data with Missing Observations</a></li>
<li class="chapter" data-level="6.3" data-path="data2.html"><a href="data2.html#summarizing-data-frames"><i class="fa fa-check"></i><b>6.3</b> Summarizing Data Frames</a><ul>
<li class="chapter" data-level="6.3.1" data-path="data2.html"><a href="data2.html#column-and-row-summaries"><i class="fa fa-check"></i><b>6.3.1</b> Column (and Row) Summaries</a></li>
<li class="chapter" data-level="6.3.2" data-path="data2.html"><a href="data2.html#apply"><i class="fa fa-check"></i><b>6.3.2</b> The <code>apply()</code> Function</a></li>
<li class="chapter" data-level="6.3.3" data-path="data2.html"><a href="data2.html#saving-typing-using-with"><i class="fa fa-check"></i><b>6.3.3</b> Saving Typing Using <code>with()</code></a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="data2.html"><a href="data2.html#transforming-a-data-frame"><i class="fa fa-check"></i><b>6.4</b> Transforming a Data Frame</a><ul>
<li class="chapter" data-level="6.4.1" data-path="data2.html"><a href="data2.html#adding-variables"><i class="fa fa-check"></i><b>6.4.1</b> Adding Variables</a></li>
<li class="chapter" data-level="6.4.2" data-path="data2.html"><a href="data2.html#removing-variables"><i class="fa fa-check"></i><b>6.4.2</b> Removing Variables</a></li>
<li class="chapter" data-level="6.4.3" data-path="data2.html"><a href="data2.html#transforming-variables"><i class="fa fa-check"></i><b>6.4.3</b> Transforming Variables</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="data2.html"><a href="data2.html#rearranging-variables"><i class="fa fa-check"></i><b>6.5</b> Rearranging Variables</a></li>
<li class="chapter" data-level="6.6" data-path="data2.html"><a href="data2.html#reshaping-data"><i class="fa fa-check"></i><b>6.6</b> Reshaping Data</a><ul>
<li class="chapter" data-level="6.6.1" data-path="data2.html"><a href="data2.html#tidyr"><i class="fa fa-check"></i><b>6.6.1</b> <code>tidyr</code></a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="data2.html"><a href="data2.html#manipulating-data-with-dplyr-dplyr"><i class="fa fa-check"></i><b>6.7</b> Manipulating Data with <code>dplyr</code> #{dplyr}</a><ul>
<li class="chapter" data-level="6.7.1" data-path="data2.html"><a href="data2.html#improved-data-frames"><i class="fa fa-check"></i><b>6.7.1</b> Improved Data Frames</a></li>
<li class="chapter" data-level="6.7.2" data-path="data2.html"><a href="data2.html#filtering-data-by-row"><i class="fa fa-check"></i><b>6.7.2</b> Filtering Data by Row</a></li>
<li class="chapter" data-level="6.7.3" data-path="data2.html"><a href="data2.html#selecting-variables-by-column"><i class="fa fa-check"></i><b>6.7.3</b> Selecting variables by column</a></li>
<li class="chapter" data-level="6.7.4" data-path="data2.html"><a href="data2.html#pipes"><i class="fa fa-check"></i><b>6.7.4</b> Pipes</a></li>
<li class="chapter" data-level="6.7.5" data-path="data2.html"><a href="data2.html#arranging-data-by-row"><i class="fa fa-check"></i><b>6.7.5</b> Arranging Data by Row</a></li>
<li class="chapter" data-level="6.7.6" data-path="data2.html"><a href="data2.html#renaming-variables"><i class="fa fa-check"></i><b>6.7.6</b> Renaming Variables</a></li>
<li class="chapter" data-level="6.7.7" data-path="data2.html"><a href="data2.html#data-summaries-and-grouping"><i class="fa fa-check"></i><b>6.7.7</b> Data Summaries and Grouping</a></li>
<li class="chapter" data-level="6.7.8" data-path="data2.html"><a href="data2.html#creating-new-variables"><i class="fa fa-check"></i><b>6.7.8</b> Creating New Variables</a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="data2.html"><a href="data2.html#practice-exercises-3"><i class="fa fa-check"></i><b>6.8</b> Practice Exercises</a></li>
<li class="chapter" data-level="6.9" data-path="data2.html"><a href="data2.html#homework-3"><i class="fa fa-check"></i><b>6.9</b> Homework</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="functions-and-programming.html"><a href="functions-and-programming.html"><i class="fa fa-check"></i><b>7</b> Functions and Programming</a><ul>
<li class="chapter" data-level="7.1" data-path="functions-and-programming.html"><a href="functions-and-programming.html#r-functions"><i class="fa fa-check"></i><b>7.1</b> R Functions</a><ul>
<li class="chapter" data-level="7.1.1" data-path="functions-and-programming.html"><a href="functions-and-programming.html#creating-functions"><i class="fa fa-check"></i><b>7.1.1</b> Creating Functions</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="functions-and-programming.html"><a href="functions-and-programming.html#programming-conditional-statements"><i class="fa fa-check"></i><b>7.2</b> Programming: Conditional Statements</a><ul>
<li class="chapter" data-level="7.2.1" data-path="functions-and-programming.html"><a href="functions-and-programming.html#comparison-and-logical-operators"><i class="fa fa-check"></i><b>7.2.1</b> Comparison and Logical Operators</a></li>
<li class="chapter" data-level="7.2.2" data-path="functions-and-programming.html"><a href="functions-and-programming.html#if-else-statements"><i class="fa fa-check"></i><b>7.2.2</b> If else statements</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="functions-and-programming.html"><a href="functions-and-programming.html#arith"><i class="fa fa-check"></i><b>7.3</b> Computer Arithmetic</a></li>
<li class="chapter" data-level="7.4" data-path="functions-and-programming.html"><a href="functions-and-programming.html#loops"><i class="fa fa-check"></i><b>7.4</b> Loops</a><ul>
<li class="chapter" data-level="7.4.1" data-path="functions-and-programming.html"><a href="functions-and-programming.html#a-repeat-loop"><i class="fa fa-check"></i><b>7.4.1</b> A Repeat Loop</a></li>
<li class="chapter" data-level="7.4.2" data-path="functions-and-programming.html"><a href="functions-and-programming.html#a-while-loop"><i class="fa fa-check"></i><b>7.4.2</b> A While Loop</a></li>
<li class="chapter" data-level="7.4.3" data-path="functions-and-programming.html"><a href="functions-and-programming.html#a-for-loop"><i class="fa fa-check"></i><b>7.4.3</b> A For Loop</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="functions-and-programming.html"><a href="functions-and-programming.html#efficiency-considerations"><i class="fa fa-check"></i><b>7.5</b> Efficiency Considerations</a><ul>
<li class="chapter" data-level="7.5.1" data-path="functions-and-programming.html"><a href="functions-and-programming.html#growing-objects"><i class="fa fa-check"></i><b>7.5.1</b> Growing Objects</a></li>
<li class="chapter" data-level="7.5.2" data-path="functions-and-programming.html"><a href="functions-and-programming.html#vectorization"><i class="fa fa-check"></i><b>7.5.2</b> Vectorization</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="functions-and-programming.html"><a href="functions-and-programming.html#more-on-functions"><i class="fa fa-check"></i><b>7.6</b> More on Functions</a></li>
<li class="chapter" data-level="7.7" data-path="functions-and-programming.html"><a href="functions-and-programming.html#calling-functions"><i class="fa fa-check"></i><b>7.7</b> Calling Functions</a><ul>
<li class="chapter" data-level="7.7.1" data-path="functions-and-programming.html"><a href="functions-and-programming.html#the-...-argument"><i class="fa fa-check"></i><b>7.7.1</b> The <code>...</code> argument</a></li>
<li class="chapter" data-level="7.7.2" data-path="functions-and-programming.html"><a href="functions-and-programming.html#lazy-evaluation"><i class="fa fa-check"></i><b>7.7.2</b> Lazy Evaluation</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="functions-and-programming.html"><a href="functions-and-programming.html#homework-4"><i class="fa fa-check"></i><b>7.8</b> Homework</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="sp.html"><a href="sp.html"><i class="fa fa-check"></i><b>8</b> Spatial Data Visualization and Analysis</a><ul>
<li class="chapter" data-level="8.1" data-path="sp.html"><a href="sp.html#overview"><i class="fa fa-check"></i><b>8.1</b> Overview</a><ul>
<li class="chapter" data-level="8.1.1" data-path="sp.html"><a href="sp.html#some-spatial-data-packages"><i class="fa fa-check"></i><b>8.1.1</b> Some Spatial Data Packages</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="sp.html"><a href="sp.html#motivating-data"><i class="fa fa-check"></i><b>8.2</b> Motivating Data</a></li>
<li class="chapter" data-level="8.3" data-path="sp.html"><a href="sp.html#reading-spatial-data-into-r"><i class="fa fa-check"></i><b>8.3</b> Reading Spatial Data into R</a></li>
<li class="chapter" data-level="8.4" data-path="sp.html"><a href="sp.html#coordinate-reference-systems"><i class="fa fa-check"></i><b>8.4</b> Coordinate Reference Systems</a></li>
<li class="chapter" data-level="8.5" data-path="sp.html"><a href="sp.html#ggmap"><i class="fa fa-check"></i><b>8.5</b> Illustration using <code>ggmap</code></a></li>
<li class="chapter" data-level="8.6" data-path="sp.html"><a href="sp.html#illustration-using-leaflet"><i class="fa fa-check"></i><b>8.6</b> Illustration using <code>leaflet</code></a></li>
<li class="chapter" data-level="8.7" data-path="sp.html"><a href="sp.html#subsetting-spatial-data"><i class="fa fa-check"></i><b>8.7</b> Subsetting Spatial Data</a><ul>
<li class="chapter" data-level="8.7.1" data-path="sp.html"><a href="sp.html#fetching-and-cropping-data-using-raster"><i class="fa fa-check"></i><b>8.7.1</b> Fetching and Cropping Data using <code>raster</code></a></li>
<li class="chapter" data-level="8.7.2" data-path="sp.html"><a href="sp.html#logical-index-and-name-subsetting"><i class="fa fa-check"></i><b>8.7.2</b> Logical, Index, and Name Subsetting</a></li>
<li class="chapter" data-level="8.7.3" data-path="sp.html"><a href="sp.html#spatial-subsetting-and-overlay"><i class="fa fa-check"></i><b>8.7.3</b> Spatial Subsetting and Overlay</a></li>
<li class="chapter" data-level="8.7.4" data-path="sp.html"><a href="sp.html#spatial-aggregation"><i class="fa fa-check"></i><b>8.7.4</b> Spatial Aggregation</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="sp.html"><a href="sp.html#where-to-go-from-here"><i class="fa fa-check"></i><b>8.8</b> Where to go from here</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R Programming for Data Sciences</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data2" class="section level1">
<h1><span class="header-section-number">Chapter 6</span> Working with Data</h1>
<p>Bringing data into R, exporting data from R in a form that is readable by other software, cleaning and reshaping data, and other data manipulation tasks are an important and often overlooked component of data science. The book <span class="citation">Spector (<a href="#ref-SpectorDataManipulation">2008</a>)</span>, while a few years old, is still an excellent reference for data-related issues. And the  manual, available online at , is an up-to-date (and free) reference on importing a wide variety of datasets into R and on exporting data in various forms.</p>
<div id="reading-data-into-r" class="section level2">
<h2><span class="header-section-number">6.1</span> Reading Data into R</h2>
<p>Data come in a dizzying variety of forms. It might be in a proprietary format such as an <a href="https://en.wikipedia.org/wiki/Microsoft_Excel">.xlsx</a> Excel file, a <a href="https://en.wikipedia.org/wiki/SPSS">.sav</a> SPSS file, or a <a href="https://en.wikipedia.org/wiki/Minitab">.mtw</a> Minitab file. It might be structured using a <a href="https://en.wikipedia.org/wiki/Relational_model%7D%7Brelational%20model">relational model</a> comprising many tables that need to be connected via key-value pairs. It might be a data-interchange format such as <a href="http://www.json.org/">JSON</a> (JavaScript Object Notation), or a markup language such as <a href="https://en.wikipedia.org/wiki/XML">XML</a> (Extensible Markup Language), perhaps with specialized standards for describing ecological information, see <a href="https://en.wikipedia.org/wiki/Ecological_Metadata_Language">EML</a> (Ecological Metadata Language). Both XML and EML are common data metadata formats (i.e., data that provides information about other data). Fortunately many datasets are (or can be) saved as plain text files, and most software can both read and write such files, so our initial focus will be on reading plain text files into R and saving data from R in plain text format. RStudio provides a handy <a href="http://www.rstudio.com/resources/cheatsheets">data import cheat sheet</a> for many of the read functions detailed in this section.</p>
<p>The <code>foreign</code> R package provides functions to directly read data saved in some of the proprietary formats into R, which is sometimes unavoidable, but if possible it is good to save data from another package as plain text and then read this plain text file into R. In Chapter <a href="#xml"><strong>??</strong></a> methods for reading web-based data sets into R will be discussed.</p>
<p>The function <code>read.table()</code> and its offshoots such as <code>read.csv()</code> are used to read in rectangular data from a text file. For example, the file <code>BrainAndBody.csv</code> contains data<a href="#fn27" class="footnote-ref" id="fnref27"><sup>27</sup></a> on the brain weight, body weight, and name of some terrestrial animals. Here are the first few lines of that file:</p>
<pre><code>body,brain,name
1.35,8.1,Mountain beaver
465,423,Cow
36.33,119.5,Grey wolf
27.66,115,Goat
1.04,5.5,Guinea pig</code></pre>
<p>As is evident, the first line of the file contains the names of the three variables, separated (delimited) by commas. Each subsequent line contains the body weight, brain weight, and name of a specific terrestrial animal.</p>
<p>This file is accessible at the url <a href="http://blue.for.msu.edu/FOR875/data/BrainAndBody.csv" class="uri">http://blue.for.msu.edu/FOR875/data/BrainAndBody.csv</a>. The <code>read.table()</code> function is used to read these data into an R data frame.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>u.bb &lt;-<span class="st"> &quot;http://blue.for.msu.edu/FOR875/data/BrainAndBody.csv&quot;</span>
<span class="op">&gt;</span><span class="st"> </span>BrainBody &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">file =</span> u.bb, <span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>, 
<span class="op">+</span><span class="st">                         </span><span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
<span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(BrainBody)</code></pre>
<p>The arguments used in this call to <code>read.table()</code> include:</p>
<ol style="list-style-type: decimal">
<li><code>file = u.bb</code>, which tells R the location of the file. In this case the string <code>http://blue.for.msu.edu/FOR875/data/BrainAndBody.csv</code> giving the location is rather long, so it was first assigned to the object <code>u.bb</code>.</li>
<li><code>header = TRUE</code>, which tells R the first line of the file gives the names of the variables.</li>
<li><code>sep = &quot;,&quot;</code>, which tells R that a comma separates the fields in the file.</li>
<li><code>stringsAsFactors = FALSE</code> which tells R not to convert character vectors to factors.</li>
</ol>
<p>The function <code>read.csv()</code> is the same as <code>read.table()</code> except the default separator is a comma, whereas the default separator for <code>read.table()</code> is whitespace.</p>
<p>The file <code>BrainAndBody.tsv</code> contains the same data, except a tab is used in place of a comma to separate fields. The only change needed to read in the data in this file is in the <code>sep</code> argument (and of course the <code>file</code> argument, since the data are stored in a different file):</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>u.bb &lt;-<span class="st"> &quot;http://blue.for.msu.edu/FOR875/data/BrainAndBody.tsv&quot;</span>
<span class="op">&gt;</span><span class="st"> </span>BrainBody2 &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">file =</span> u.bb, <span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>, 
<span class="op">+</span><span class="st">                          </span><span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
<span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(BrainBody2)</code></pre>
<p>File extensions, e.g., <code>.csv</code> or <code>.tsv</code>, are naming conventions only and are there to remind us how the columns are separated. In other words, they have no influence on R’s file read functions.</p>
<p>A third file, <code>BrainAndBody.txt</code>, contains the same data, but also contains a few lines of explanatory text above the names of the variables. It also uses whitespace rather than a comma or a tab as a separator. Here are the first several lines of the file.</p>
<pre><code>This file contains data
on brain and body
weights of several terrestrial animals

&quot;body&quot; &quot;brain&quot; &quot;name&quot;
1.35 8.1 &quot;Mountain beaver&quot;
465 423 &quot;Cow&quot;
36.33 119.5 &quot;Grey wolf&quot;
27.66 115 &quot;Goat&quot;
1.04 5.5 &quot;Guinea pig&quot;
11700 50 &quot;Dipliodocus&quot;
2547 4603 &quot;Asian elephant&quot;</code></pre>
<p>Notice that in this file the values of <code>name</code> are put inside of quotation marks. This is necessary since instead R would (reasonably) assume the first line contained the values of four variables, the values being <code>1.35</code>, <code>8.1</code>, <code>Mountain</code>, and <code>beaver</code> while in reality there are only three values desired, with <code>Mountain beaver</code> being the third.</p>
<p>To read in this file we need to tell R to skip the first five lines and to use whitespace as the separator. The <code>skip</code> argument handles the first, and the <code>sep</code> argument the second. First let’s see what happens if we don’t use the <code>skip</code> argument.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>u.bb &lt;-<span class="st"> &quot;http://blue.for.msu.edu/FOR875/data/BrainAndBody.txt&quot;</span>
<span class="op">&gt;</span><span class="st"> </span>BrainBody3 &lt;-<span class="st"> </span><span class="kw">read.table</span>(u.bb, <span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>, 
<span class="op">+</span><span class="st">                          </span><span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</code></pre>
<p>R assumed the first line of the file contained the variable names, since <code>header = TRUE</code> was specified, and counted four including <code>This</code>, <code>file</code>, <code>contains</code>, and <code>data</code>. So in the first line of actual data, R expected four columns containing data plus possibly a fifth column containing row names for the data set, and complained that “line 1 did not have 5 elements.” The error message is somewhat mysterious, since it starts with “Error in scan.” This happens because <code>read.table()</code> actually uses a more basic R function called <code>scan()</code> to do the work.</p>
<p>Here’s how to read in the file correctly.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>u.bb &lt;-<span class="st"> &quot;http://blue.for.msu.edu/FOR875/data/BrainAndBody.txt&quot;</span>
<span class="op">&gt;</span><span class="st"> </span>BrainBody3 &lt;-<span class="st"> </span><span class="kw">read.table</span>(u.bb, <span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>, 
<span class="op">+</span><span class="st">                          </span><span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>, <span class="dt">skip =</span> <span class="dv">4</span>)
<span class="op">&gt;</span><span class="st"> </span>BrainBody3[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,]</code></pre>
</div>
<div id="reading-data-with-missing-observations" class="section level2">
<h2><span class="header-section-number">6.2</span> Reading Data with Missing Observations</h2>
<p>Missing data are represented in many ways. Sometimes a missing data point is just that, i.e., the place where it should be in the file is blank. Other times specific numbers such as <span class="math inline">\(-9999\)</span> or specific symbols are used. The <code>read.table()</code> function has an argument <code>na.string</code> that allows the user to specify how missing data is indicated in the source file.</p>
<p>The site <a href="http://www.wunderground.com/history/" class="uri">http://www.wunderground.com/history/</a> makes weather data available for locations around the world from dates going back to 1945. The file <code>WeatherKLAN2014.csv</code> contains weather data for Lansing, Michigan for the year 2014. Here are the first few lines of that file:</p>
<pre><code>EST,Max TemperatureF,Min TemperatureF, Events
1/1/14,14,9,Snow
1/2/14,13,-3,Snow
1/3/14,13,-11,Snow
1/4/14,31,13,Snow
1/5/14,29,16,Fog-Snow
1/6/14,16,-12,Fog-Snow
1/7/14,2,-13,Snow
1/8/14,17,-1,Snow
1/9/14,21,2,Snow
1/10/14,39,21,Fog-Rain-Snow
1/11/14,41,32,Fog-Rain
1/12/14,39,31,</code></pre>
<p>Look at the last line, and notice that instead of an <code>Event</code> such as <code>Snow</code> or <code>Fog-Snow</code> there is nothing after the comma. This observation is missing, but rather than using an explicit code such as <code>NA</code>, the site just leaves that entry blank. To read these data into R we will supply the argument <code>na.string = &quot;&quot;</code> which tells R the file indicates missing data by leaving the appropriate entry blank.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>u.weather &lt;-<span class="st"> &quot;http://blue.for.msu.edu/FOR875/data/WeatherKLAN2014.csv&quot;</span>
<span class="op">&gt;</span><span class="st"> </span>WeatherKLAN2014 &lt;-<span class="st"> </span><span class="kw">read.csv</span>(u.weather, <span class="dt">header=</span><span class="ot">TRUE</span>, 
<span class="op">+</span><span class="st">                             </span><span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>, <span class="dt">na.string =</span> <span class="st">&quot;&quot;</span>)
<span class="op">&gt;</span><span class="st"> </span>WeatherKLAN2014[<span class="dv">1</span><span class="op">:</span><span class="dv">15</span>,]</code></pre>
</div>
<div id="summarizing-data-frames" class="section level2">
<h2><span class="header-section-number">6.3</span> Summarizing Data Frames</h2>
<p>Some common data tasks include variable summaries such as means or standard deviations, transforming an existing variable, and creating new variables. As with many tasks, there are several ways to accomplish each of these.</p>
<div id="column-and-row-summaries" class="section level3">
<h3><span class="header-section-number">6.3.1</span> Column (and Row) Summaries</h3>
<p>The file <code>WeatherKLAN2014Full.csv</code> contains a more complete set of weather data variables than <code>WeatherKLAN2014.csv</code>, from the same source, <a href="http://www.wunderground.com/history" class="uri">http://www.wunderground.com/history</a>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>u.weather &lt;-<span class="st"> &quot;http://blue.for.msu.edu/FOR875/data/WeatherKLAN2014Full.csv&quot;</span>
<span class="op">&gt;</span><span class="st"> </span>WeatherKLAN2014Full &lt;-<span class="st"> </span><span class="kw">read.csv</span>(u.weather, <span class="dt">header=</span><span class="ot">TRUE</span>, 
<span class="op">+</span><span class="st">                                </span><span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>, 
<span class="op">+</span><span class="st">                                </span><span class="dt">na.string =</span> <span class="st">&quot;&quot;</span>)
<span class="op">&gt;</span><span class="st"> </span><span class="kw">names</span>(WeatherKLAN2014Full)</code></pre>
<p>How can we compute the mean for each variable? One possibility is to do this a variable at a time:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span><span class="kw">mean</span>(WeatherKLAN2014Full<span class="op">$</span>Mean.TemperatureF)
<span class="op">&gt;</span><span class="st"> </span><span class="kw">mean</span>(WeatherKLAN2014Full<span class="op">$</span>Min.TemperatureF)
<span class="op">&gt;</span><span class="st"> </span><span class="kw">mean</span>(WeatherKLAN2014Full<span class="op">$</span>Max.TemperatureF)
<span class="op">&gt;</span><span class="st"> </span><span class="co">## Et Cetera</span></code></pre>
<p>This is pretty inefficient. Fortunately there is a <code>colMeans()</code> function which computes the mean of each column (or a specified number of columns) in a data frame. Some columns in the current data frame are not numeric, and obviously we don’t want to ask R to compute means for these columns. We use <code>str()</code> to investigate.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span><span class="kw">str</span>(WeatherKLAN2014Full)</code></pre>
<p>It isn’t surprising that <code>EST</code> and <code>Events</code> are not numeric, but is surprising that <code>PrecipitationIn</code>, which measures precipitation in inches, also is not numeric, but is character. Let’s investigate further.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>WeatherKLAN2014Full<span class="op">$</span>PrecipitationIn[<span class="dv">1</span><span class="op">:</span><span class="dv">50</span>]</code></pre>
<p>Now it’s more clear. The original data file included <code>T</code> in the precipitation column to represent a “trace” of precipitation, which is precipitation greater than <span class="math inline">\(0\)</span> but less than <span class="math inline">\(0.01\)</span> inches. One possibility would be to set all these values to <code>&quot;0&quot;</code>, and then to convert the column to numeric. For now we will just leave the <code>PrecipitationIn</code> column out of the columns for which we request the mean.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span><span class="kw">colMeans</span>(WeatherKLAN2014Full[, <span class="kw">c</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">19</span>, <span class="dv">21</span>, <span class="dv">23</span>)])</code></pre>
</div>
<div id="apply" class="section level3">
<h3><span class="header-section-number">6.3.2</span> The <code>apply()</code> Function</h3>
<p>R also has functions <code>rowMeans()</code>, <code>colSums()</code>, and <code>rowSums()</code>. But what if we want to compute the median or standard deviation of columns of data, or some other summary statistic? For this the <code>apply()</code> function can be used. This function applies a user-chosen function to either the rows or columns (or both) of a data frame. The arguments are:</p>
<ol style="list-style-type: decimal">
<li><code>X</code>: the data frame of interest</li>
<li><code>MARGIN</code>: specifying either rows (<code>MARGIN = 1</code>) or columns (<code>MARGIN = 2</code>)</li>
<li><code>FUN</code>: the function to be applied.</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span><span class="kw">apply</span>(<span class="dt">X =</span> WeatherKLAN2014Full[, <span class="kw">c</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">19</span>, <span class="dv">21</span>, <span class="dv">23</span>)], <span class="dt">MARGIN =</span> <span class="dv">2</span>, 
<span class="op">+</span><span class="st">   </span><span class="dt">FUN =</span> sd)</code></pre>
<p>As with any R function the arguments don’t need to be named as long as they are specified in the correct order, so</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span><span class="kw">apply</span>(WeatherKLAN2014Full[, <span class="kw">c</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">19</span>, <span class="dv">21</span>, <span class="dv">23</span>)], <span class="dv">2</span>, sd)</code></pre>
<p>has the same result.</p>
</div>
<div id="saving-typing-using-with" class="section level3">
<h3><span class="header-section-number">6.3.3</span> Saving Typing Using <code>with()</code></h3>
<p>Consider calculating the mean of the maximum temperature values for those days where the cloud cover is less than 4 and when the maximum humidity is over 85. We can do this using subsetting.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span><span class="kw">mean</span>(WeatherKLAN2014Full<span class="op">$</span>Max.TemperatureF[
<span class="op">+</span><span class="st">                              </span>WeatherKLAN2014Full<span class="op">$</span>CloudCover <span class="op">&lt;</span><span class="st"> </span><span class="dv">4</span> <span class="op">&amp;</span><span class="st"> </span>
<span class="op">+</span><span class="st">                              </span>WeatherKLAN2014Full<span class="op">$</span>Max.Humidity <span class="op">&gt;</span><span class="st"> </span><span class="dv">85</span>])</code></pre>
<p>While this works, it requires a lot of typing, since each time we refer to a variable in the data set we need to preface its name by <code>WeatherKLAN2014Full$</code>. The <code>with()</code> function tells R that we are working with a particular data frame, and we don’t need to keep typing the name of the data frame.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span><span class="kw">with</span>(WeatherKLAN2014Full, <span class="kw">mean</span>(Max.TemperatureF[CloudCover <span class="op">&lt;</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span><span class="dv">4</span> <span class="op">&amp;</span><span class="st"> </span>Max.Humidity <span class="op">&gt;</span><span class="st"> </span><span class="dv">85</span>]))</code></pre>
</div>
</div>
<div id="transforming-a-data-frame" class="section level2">
<h2><span class="header-section-number">6.4</span> Transforming a Data Frame</h2>
<p>Variables are often added to, removed from, changed in, or rearranged in a data frame. The subsetting features of R make this reasonably easy. We will investigate this in the context of the <code>gapminder</code> data frame. If the <code>gapminder</code> library is not yet installed, use <code>install.packages(&quot;gapminder&quot;)</code> to install it locally.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(gapminder)
<span class="op">&gt;</span><span class="st"> </span><span class="kw">str</span>(gapminder)</code></pre>
<div id="adding-variables" class="section level3">
<h3><span class="header-section-number">6.4.1</span> Adding Variables</h3>
<p>The data frame contains per capita GDP and population, and it might be interesting to create a variable that gives the total GDP by multiplying these two variables. (If we were interested in an accurate value for the total GDP we would probably be better off getting this information directly, since it is likely that the per capita GDP values in the data frame are rounded substantially.)</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>gapminder<span class="op">$</span>TotalGDP &lt;-<span class="st"> </span>gapminder<span class="op">$</span>gdpPercap <span class="op">*</span><span class="st"> </span>gapminder<span class="op">$</span>pop
<span class="op">&gt;</span><span class="st"> </span><span class="kw">str</span>(gapminder)</code></pre>
<p>Analogous to the <code>with()</code> function, there is a function <code>within()</code> which can simplify the syntax. Whereas <code>with()</code> does not change the data frame, <code>within()</code> can. Note, below I first remove the altered gapminder dataframe using <code>rm()</code> then bring a clean copy back in by reloading the <code>gapminder</code> package.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span><span class="kw">rm</span>(gapminder)
<span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(gapminder)
<span class="op">&gt;</span><span class="st"> </span><span class="kw">str</span>(gapminder)
<span class="op">&gt;</span><span class="st"> </span>gapminder &lt;-<span class="st"> </span><span class="kw">within</span>(gapminder, TotalGDP &lt;-<span class="st"> </span>gdpPercap <span class="op">*</span><span class="st"> </span>pop)
<span class="op">&gt;</span><span class="st"> </span><span class="kw">str</span>(gapminder)</code></pre>
<p>A nice feature of <code>within()</code> is its ability to add more than one variable at a time to a data frame. In this case the two or more formulas creating new variables must be enclosed in braces.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>gapminder &lt;-<span class="st"> </span><span class="kw">within</span>(gapminder, {TotalGDP &lt;-<span class="st"> </span>gdpPercap <span class="op">*</span><span class="st"> </span>pop
<span class="op">+</span><span class="st">     </span>lifeExpMonths &lt;-<span class="st"> </span>lifeExp <span class="op">*</span><span class="st"> </span><span class="dv">12</span>})
<span class="op">&gt;</span><span class="st"> </span><span class="kw">str</span>(gapminder)</code></pre>
</div>
<div id="removing-variables" class="section level3">
<h3><span class="header-section-number">6.4.2</span> Removing Variables</h3>
<p>After reflection we may realize the new variables we added to the <code>gapminder</code> data frame are not useful, and should be removed.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span><span class="kw">str</span>(gapminder)
<span class="op">&gt;</span><span class="st"> </span>gapminder &lt;-<span class="st"> </span>gapminder[<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>]
<span class="op">&gt;</span><span class="st"> </span><span class="kw">str</span>(gapminder)</code></pre>
<p>The same result could be obtained via <code>gapminder &lt;- gapminder[, 1:6]</code>. The first method uses the fact that a data frame is also a list, and uses list subsetting methods. It is slightly preferable, since even if only one variable is retained, the object will still be a data frame, while the other method can return a vector in this case. Note this difference in the resulting <code>x</code> variable below (again this behavior can be frustrating at times if it is not anticipated).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>a &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">y =</span> <span class="kw">c</span>(<span class="st">&quot;dog&quot;</span>, <span class="st">&quot;cat&quot;</span>, <span class="st">&quot;pig&quot;</span>), <span class="dt">z =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">1</span>, 
<span class="op">+</span><span class="st">   </span><span class="dt">to =</span> <span class="dv">2</span>, <span class="dt">length =</span> <span class="dv">3</span>))
<span class="op">&gt;</span><span class="st"> </span>a
<span class="op">&gt;</span><span class="st"> </span>a &lt;-<span class="st"> </span>a[<span class="dv">1</span>]
<span class="op">&gt;</span><span class="st"> </span>a
<span class="op">&gt;</span><span class="st"> </span>a &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">y =</span> <span class="kw">c</span>(<span class="st">&quot;dog&quot;</span>, <span class="st">&quot;cat&quot;</span>, <span class="st">&quot;pig&quot;</span>), <span class="dt">z =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">1</span>, 
<span class="op">+</span><span class="st">   </span><span class="dt">to =</span> <span class="dv">2</span>, <span class="dt">length =</span> <span class="dv">3</span>))
<span class="op">&gt;</span><span class="st"> </span>a
<span class="op">&gt;</span><span class="st"> </span>a &lt;-<span class="st"> </span>a[, <span class="dv">1</span>]
<span class="op">&gt;</span><span class="st"> </span>a</code></pre>
<p>One can also use a negative sign in front of the variable number(s). For example, <code>a[-(2:3)]</code> would drop the first two columns of <code>a</code>. Some care is needed when removing variables using the negative sign—what happens if you write <code>a[-2:3]</code> instead of <code>a[-(2:3)]</code> (why are the parentheses important here)?</p>
<p>An alternative approach is to set the variables you’d like to remove to <code>NULL</code>. For example, <code>a[c(&quot;y&quot;,&quot;z&quot;)] &lt;- NULL</code> and <code>a[,2:3] &lt;- NULL</code> produce the same result as above.</p>
</div>
<div id="transforming-variables" class="section level3">
<h3><span class="header-section-number">6.4.3</span> Transforming Variables</h3>
<p>Consider the gapminder data again. Possibly we don’t want to add a new variable that gives life expectancy in months, but rather want to modify the existing variable to measure life expectancy in months. Here are two ways to accomplish this.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span><span class="kw">rm</span>(gapminder)
<span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(gapminder)
<span class="op">&gt;</span><span class="st"> </span>gapminder<span class="op">$</span>lifeExp[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]
<span class="op">&gt;</span><span class="st"> </span>gapminder<span class="op">$</span>lifeExp &lt;-<span class="st"> </span>gapminder<span class="op">$</span>lifeExp <span class="op">*</span><span class="st"> </span><span class="dv">12</span>
<span class="op">&gt;</span><span class="st"> </span>gapminder<span class="op">$</span>lifeExp[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]
<span class="op">&gt;</span><span class="st"> </span><span class="kw">rm</span>(gapminder)
<span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(gapminder)
<span class="op">&gt;</span><span class="st"> </span>gapminder<span class="op">$</span>lifeExp[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]
<span class="op">&gt;</span><span class="st"> </span>gapminder &lt;-<span class="st"> </span><span class="kw">within</span>(gapminder, lifeExp &lt;-<span class="st"> </span>lifeExp <span class="op">*</span><span class="st"> </span><span class="dv">12</span>)
<span class="op">&gt;</span><span class="st"> </span>gapminder<span class="op">$</span>lifeExp[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</code></pre>
</div>
</div>
<div id="rearranging-variables" class="section level2">
<h2><span class="header-section-number">6.5</span> Rearranging Variables</h2>
<p>Consider the full weather data set again.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>u.weather &lt;-<span class="st"> &quot;http://blue.for.msu.edu/FOR875/data/WeatherKLAN2014Full.csv&quot;</span>
<span class="op">&gt;</span><span class="st"> </span>WeatherKLAN2014Full &lt;-<span class="st"> </span><span class="kw">read.csv</span>(u.weather, <span class="dt">header=</span><span class="ot">TRUE</span>, 
<span class="op">+</span><span class="st">                                 </span><span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>,
<span class="op">+</span><span class="st">                                 </span><span class="dt">na.string =</span> <span class="st">&quot;&quot;</span>)
<span class="op">&gt;</span><span class="st"> </span><span class="kw">names</span>(WeatherKLAN2014Full)</code></pre>
<p>If we want the wind speed variables to come right after the date, we can again use subsetting.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>WeatherKLAN2014Full &lt;-<span class="st"> </span>WeatherKLAN2014Full[<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">17</span>, <span class="dv">18</span>, 
<span class="op">+</span><span class="st">   </span><span class="dv">19</span>, <span class="dv">2</span><span class="op">:</span><span class="dv">16</span>, <span class="dv">20</span><span class="op">:</span><span class="dv">23</span>)]
<span class="op">&gt;</span><span class="st"> </span><span class="kw">names</span>(WeatherKLAN2014Full)</code></pre>
</div>
<div id="reshaping-data" class="section level2">
<h2><span class="header-section-number">6.6</span> Reshaping Data</h2>
<p>A data set can be represented in several different formats. Consider a (fictitious) data set on incomes of three people during three different years. Here is one representation of the data:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>yearlyIncomeWide</code></pre>
<p>Here is another representation of the same data:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>yearlyIncomeLong</code></pre>
<p>For hopefully obvious reasons, the first representation is called a <em>wide</em> representation of the data, and the second is called a <em>long</em> representation. Each has its merits. The first representation is probably easier for people to read, while the second is often the form needed for analysis by statistical software such as R. There are of course other representations. For example the rows and columns could be interchanged to create a different wide representation, or the long representation, which currently groups data by year, could group by name instead.</p>
<p>Whatever the relative merits of wide and long representations of data, transforming data from wide to long or long to wide is often required. As with many tasks, there are several ways to accomplish this in R. We will focus on a library called <code>tidyr</code> written by Hadley Wickham that performs the transformations and more.</p>
<div id="tidyr" class="section level3">
<h3><span class="header-section-number">6.6.1</span> <code>tidyr</code></h3>
<p>The R library <code>tidyr</code> has functions for converting data between formats. To illustrate its use, we examine a simple data set that explores the relationship between religion and income in the United States. The data come from a Pew survey, and are used in the <code>tidyr</code> documentation to illustrate transforming data from wide to long format.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>u.rel &lt;-<span class="st"> &quot;http://blue.for.msu.edu/FOR875/data/religion2.csv&quot;</span>
<span class="op">&gt;</span><span class="st"> </span>religion &lt;-<span class="st"> </span><span class="kw">read.csv</span>(u.rel, <span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
<span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(religion)</code></pre>
<p>As given, the columns include religion and income level, and there are counts for each of the combinations of religion and income level. For example, there are 27 people who are Agnostic and whose income is less than 10 thousand dollars, and there are 617 people who are Catholic and whose income is between 10 and 20 thousand dollars.</p>
<p>The <code>gather()</code> function can transform data from wide to long format.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(tidyr)
<span class="op">&gt;</span><span class="st"> </span>religionLong &lt;-<span class="st"> </span><span class="kw">gather</span>(<span class="dt">data =</span> religion, <span class="dt">key =</span> IncomeLevel, 
<span class="op">+</span><span class="st">                        </span><span class="dt">value =</span> Frequency, <span class="dv">2</span><span class="op">:</span><span class="dv">11</span>)
<span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(religionLong)
<span class="op">&gt;</span><span class="st"> </span><span class="kw">tail</span>(religionLong)</code></pre>
<p>To use <code>gather()</code> we specified the data frame (<code>data = religion</code>), the name we want to give to the column created from the income levels (<code>key = IncomeLevel</code>), the name we want to give to the column containing the frequency values (<code>value = Frequency</code>) and the columns to gather (<code>2:11</code>).</p>
<p>Columns to be gathered can be specified by name also, and we can also specify which columns should be omitted using a negative sign in front of the name(s). So the following creates an equivalent data frame:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>religionLong &lt;-<span class="st"> </span><span class="kw">gather</span>(<span class="dt">data =</span> religion, <span class="dt">key =</span> IncomeLevel, 
<span class="op">+</span><span class="st">                        </span><span class="dt">value =</span> Frequency, <span class="op">-</span>religion)
<span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(religionLong)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>religionWide &lt;-<span class="st"> </span><span class="kw">spread</span>(<span class="dt">data =</span> religionLong, <span class="dt">key =</span> IncomeLevel, 
<span class="op">+</span><span class="st">   </span><span class="dt">value =</span> Frequency)
<span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(religionWide)</code></pre>
<p>Here we specify the data frame (<code>religionLong</code>), the column (<code>IncomeLevel</code>) to be spread, and the column of values (<code>Frequency</code>) to be spread among the newly created columns. As can be seen, this particular call to <code>spread()</code> yields the original data frame.</p>
<p><code>tidyr</code> provides two other useful functions to separate and unite variables based on some deliminator. Consider again the <code>yearlyIncomeWide</code> table. Say we want to split the <code>name</code> variable into first and last name. This can be done using the <code>separate()</code> function.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>firstLast &lt;-<span class="st"> </span><span class="kw">separate</span>(<span class="dt">data =</span> yearlyIncomeLong, <span class="dt">col =</span> name, 
<span class="op">+</span><span class="st">                       </span><span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;first&quot;</span>, <span class="st">&quot;last&quot;</span>), <span class="dt">sep=</span><span class="st">&quot;</span><span class="ch">\\</span><span class="st">s&quot;</span>)
<span class="op">&gt;</span><span class="st"> </span><span class="kw">print</span>(firstLast)</code></pre>
<p>Now say, you’re not happy with that and you want to combine the name column again, but this time separate the first and last name with a underscore. This is done using the <code>unite()</code> function.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span><span class="kw">unite</span>(firstLast, <span class="dt">col =</span> name, first, last, <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>)</code></pre>
</div>
</div>
<div id="manipulating-data-with-dplyr-dplyr" class="section level2">
<h2><span class="header-section-number">6.7</span> Manipulating Data with <code>dplyr</code> #{dplyr}</h2>
<p>Much of the effort (a figure of 80% is sometimes suggested) in data analysis is spent cleaning the data and getting it ready for analysis. Having effective tools for this task can save substantial time and effort. The R package <code>dplyr</code> written by Hadley Wickham is designed, in Hadley’s words, to be “a grammar of data manipulation, providing a consistent set of verbs that help you solve the most common data manipulation challenges.” Casting data analysis tasks in terms of “grammar” should be familiar from our work with the <code>ggplot2</code> package, which was also authored by Hadley. Functions provided by <code>dplyr</code> do in fact capture key data analysis actions (i.e., verbs). These functions include</p>
<ul>
<li><code>mutate()</code> adds new variables that are functions of existing variables</li>
<li><code>select()</code> picks variables based on their names</li>
<li><code>filter()</code> picks cases based on their values</li>
<li><code>summarize()</code> reduces multiple values down to a single summary</li>
<li><code>arrange()</code> changes the ordering of the rows.</li>
</ul>
<p>These all combine naturally with a <code>group_by()</code> function that allows you to perform any operation grouped by values of one or more variables. All the tasks done using <code>dplyr</code> can be accomplished using tools already covered in this text; however, <code>dplyr</code>’s functions provide a potentially more efficient and convenient framework to accomplish these tasks. RStudio provides a convenient <a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">data wrangling cheat sheet</a> that covers many aspects of the <code>tidyr</code> and <code>dplyr</code> packages.</p>
<p>This somewhat long section on <code>dplyr</code> adapts the nice introduction by Jenny Bryan, available at <a href="http://stat545-ubc.github.io/block010_dplyr-end-single-table.html" class="uri">http://stat545-ubc.github.io/block010_dplyr-end-single-table.html</a>.</p>
<div id="improved-data-frames" class="section level3">
<h3><span class="header-section-number">6.7.1</span> Improved Data Frames</h3>
<p>The <code>dplyr</code> package provides two functions that offer improvements on data frames. First, <code>data_frame()</code> is a trimmed down version of the <code>data.frame()</code> function that is somewhat more user friendly, and won’t be discussed here. Second, <code>tbl_df()</code> creates a tibble<a href="#fn28" class="footnote-ref" id="fnref28"><sup>28</sup></a>. A tibble has two advantages over a data frame. First, when printing, it only prints the first ten rows and the columns that fit on the page, as well as some additional information about the table’s dimension, data type of variables, and non-printed columns. Second, recall that subsetting a data frame can sometimes return a vector rather than a data frame (if only one row or column is the result of the subset), a tibble does not have this behavior. Here is an example using the <code>religionWide</code> data frame.<a href="#fn29" class="footnote-ref" id="fnref29"><sup>29</sup></a></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(dplyr)
<span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(religionWide)
<span class="op">&gt;</span><span class="st"> </span>religionWide[, <span class="dv">1</span>]
<span class="op">&gt;</span><span class="st"> </span>religionWideTbl &lt;-<span class="st"> </span><span class="kw">tbl_df</span>(religionWide)
<span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(religionWideTbl)
<span class="op">&gt;</span><span class="st"> </span>religionWideTbl[, <span class="dv">1</span>]</code></pre>
<p>As seen above, note that once the data frame is reduced to one dimension by subsetting to one column, it is no longer a data frame and has been <em>simplified</em> to a vector. This might not seem like a big deal; however, it can be very frustrating and potentially break your code when you expect an object to behave like a data frame and it doesn’t because it’s now a vector. Alternatively, once we convert <code>religionWide</code> to a <code>tbl_df</code> via the <code>tbl_df()</code> function the object remains a data frame even when subsetting down to one dimension (there is no automatic simplification). Converting data frames using <code>tbl_df()</code> is not required for using <code>dplyr</code> but is convenient. Also, it is important to note that <code>tbl_df</code> is simply a wrapper around a data frame that provides some additional behaviors. The newly formed <code>tbl_df</code> object will still behave like a data frame (because it technically still is a data frame) but will have some added niceties (some of which are illustrated below).</p>
</div>
<div id="filtering-data-by-row" class="section level3">
<h3><span class="header-section-number">6.7.2</span> Filtering Data by Row</h3>
<p>Recall the <code>gapminder</code> data. These data are available in tab-separated format in <code>gapminder.tsv</code>, and can be read in using <code>read.delim()</code> (or the related read functions described previously). The <code>read.delim()</code> function defaults to <code>header = TRUE</code> so this doesn’t need to be specified explicitly. In this section we will be working with the <code>gapminder</code> data often, so we will use a short name for the data frame to save typing.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>u.gm &lt;-<span class="st"> &quot;http://blue.for.msu.edu/FOR875/data/gapminder.tsv&quot;</span>
<span class="op">&gt;</span><span class="st"> </span>gm &lt;-<span class="st"> </span><span class="kw">read.delim</span>(u.gm)
<span class="op">&gt;</span><span class="st"> </span>gm &lt;-<span class="st"> </span><span class="kw">tbl_df</span>(gm)
<span class="op">&gt;</span><span class="st"> </span><span class="kw">str</span>(gm)
<span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(gm)</code></pre>
<p>Filtering helps us to examine subsets of the data such as data from a particular country, from several specified countries, from certain years, from countries with certain populations, etc. Some examples:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span><span class="kw">filter</span>(gm, country <span class="op">==</span><span class="st"> &quot;Brazil&quot;</span>)
<span class="op">&gt;</span><span class="st"> </span><span class="kw">filter</span>(gm, country <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Brazil&quot;</span>, <span class="st">&quot;Mexico&quot;</span>))
<span class="op">&gt;</span><span class="st"> </span><span class="kw">filter</span>(gm, country <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Brazil&quot;</span>, <span class="st">&quot;Mexico&quot;</span>) <span class="op">&amp;</span><span class="st"> </span>year <span class="op">%in%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span><span class="kw">c</span>(<span class="dv">1952</span>, <span class="dv">1972</span>))
<span class="op">&gt;</span><span class="st"> </span><span class="kw">filter</span>(gm, pop <span class="op">&gt;</span><span class="st"> </span><span class="fl">3e+08</span>)
<span class="op">&gt;</span><span class="st"> </span><span class="kw">filter</span>(gm, pop <span class="op">&gt;</span><span class="st"> </span><span class="fl">3e+08</span> <span class="op">&amp;</span><span class="st"> </span>year <span class="op">==</span><span class="st"> </span><span class="dv">2007</span>)</code></pre>
<p>Notice the full results are not printed. For example, when we asked for the data for Brazil and Mexico, only the first ten rows were printed. This is an effect of using the <code>tbl_df()</code> function. Of course if we wanted to analyze the results (as we will below) the full set of data would be available.</p>
</div>
<div id="selecting-variables-by-column" class="section level3">
<h3><span class="header-section-number">6.7.3</span> Selecting variables by column</h3>
<p>Continuing with the <code>gapminder</code> data, another common task is to restrict attention to some subset of variables in the data set. The <code>select()</code> function does this.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(gm, country, year, lifeExp)
<span class="op">&gt;</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(gm, <span class="dv">2</span><span class="op">:</span><span class="dv">4</span>)
<span class="op">&gt;</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(gm, <span class="op">-</span><span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>))
<span class="op">&gt;</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(gm, <span class="kw">starts_with</span>(<span class="st">&quot;c&quot;</span>))</code></pre>
<p>Notice a few things. Variables can be selected by name or column number. As usual, a negative sign tells R to leave something out. And there are special functions such as <code>starts_with</code> that provide ways to match part of a variable’s name.</p>
</div>
<div id="pipes" class="section level3">
<h3><span class="header-section-number">6.7.4</span> Pipes</h3>
<p>Consider selecting the country, year, and population for countries in Asia or Europe. One possibility is to nest a <code>filter()</code> function inside a <code>select()</code> function.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="kw">filter</span>(gm, continent <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Asia&quot;</span>, <span class="st">&quot;Europe&quot;</span>)), 
<span class="op">+</span><span class="st">   </span>country, year, pop)</code></pre>
<p>Even a two-step process like this becomes hard to follow in this nested form, and often we will want to perform more than two operations. There is a nice feature in <code>dplyr</code> that allows us to “feed” results of one function into the first argument of a subsequent function. Another way of saying this is that we are “piping” the results into another function. The <code>%&gt;%</code> operator does the piping. Here we again restrict attention to country, year, and population for countries in Asia or Europe<a href="#fn30" class="footnote-ref" id="fnref30"><sup>30</sup></a>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>gm <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span><span class="kw">filter</span>(continent <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Asia&quot;</span>, <span class="st">&quot;Europe&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span>dplyr<span class="op">::</span><span class="kw">select</span>(country, year, pop)</code></pre>
<p>It can help to think of <code>%&gt;%</code> as representing the word “then”. The above can be read as, “Start with the data frame <code>gm</code> <em>then</em> filter it to select data from the continents Asia and Europe <em>then</em> select the variables country, year, and population from these data”.</p>
<p>The pipe operator <code>%&gt;%</code> is not restricted to functions in <code>dplyr</code>. In fact the pipe operator itself was introduced in another package called <code>magrittr</code>, but is included in <code>dplyr</code> as a convenience.</p>
</div>
<div id="arranging-data-by-row" class="section level3">
<h3><span class="header-section-number">6.7.5</span> Arranging Data by Row</h3>
<p>By default the <code>gapminder</code> data are arranged by country and then by year.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(gm, <span class="dv">15</span>)</code></pre>
<p>Possibly arranging the data by year and then country would be desired. The <code>arrange()</code> function makes this easy. We will again use pipes.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>gm <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(year, country)</code></pre>
<p>How about the data for Rwanda, arranged in order of life expectancy.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>gm <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> &quot;Rwanda&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span><span class="kw">arrange</span>(lifeExp)</code></pre>
<p>Possibly we want these data to be in decreasing (descending) order. Here, <code>desc()</code> is one of many <code>dplyr</code> helper functions.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>gm <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> &quot;Rwanda&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span><span class="kw">arrange</span>(<span class="kw">desc</span>(lifeExp))</code></pre>
<p>Possibly we want to include only the year and life expectancy, to make the message more stark.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>gm <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> &quot;Rwanda&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span>dplyr<span class="op">::</span><span class="kw">select</span>(year, lifeExp) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span><span class="kw">arrange</span>(<span class="kw">desc</span>(lifeExp)) </code></pre>
<p>For analyzing data in R, the order shouldn’t matter. But for presentation to human eyes, the order is important.</p>
</div>
<div id="renaming-variables" class="section level3">
<h3><span class="header-section-number">6.7.6</span> Renaming Variables</h3>
<p>The <code>dplyr</code> package has a <code>rename</code> function that makes renaming variables in a data frame quite easy.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>gm &lt;-<span class="st"> </span><span class="kw">rename</span>(gm, <span class="dt">population =</span> pop)
<span class="op">&gt;</span><span class="st"> </span><span class="kw">head</span>(gm)</code></pre>
</div>
<div id="data-summaries-and-grouping" class="section level3">
<h3><span class="header-section-number">6.7.7</span> Data Summaries and Grouping</h3>
<p>The <code>summarize()</code> function computes summary statistics using user provided functions for one or more columns of data in a data frame.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span><span class="kw">summarize</span>(gm, <span class="dt">meanpop =</span> <span class="kw">mean</span>(population), <span class="dt">medpop =</span> <span class="kw">median</span>(population))
<span class="op">&gt;</span><span class="st"> </span><span class="co">##or</span>
<span class="er">&gt;</span><span class="st"> </span>gm <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span><span class="kw">summarize</span>(<span class="dt">meanpop =</span> <span class="kw">mean</span>(population), <span class="dt">medpop =</span> <span class="kw">median</span>(population))</code></pre>
<p>Often we want summaries for specific components of the data. For example, we might want the median life expectancy for each continent separately. One option is subsetting:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span><span class="kw">median</span>(gm<span class="op">$</span>lifeExp[gm<span class="op">$</span>continent <span class="op">==</span><span class="st"> &quot;Africa&quot;</span>])
<span class="op">&gt;</span><span class="st"> </span><span class="kw">median</span>(gm<span class="op">$</span>lifeExp[gm<span class="op">$</span>continent <span class="op">==</span><span class="st"> &quot;Asia&quot;</span>])
<span class="op">&gt;</span><span class="st"> </span><span class="kw">median</span>(gm<span class="op">$</span>lifeExp[gm<span class="op">$</span>continent <span class="op">==</span><span class="st"> &quot;Europe&quot;</span>])
<span class="op">&gt;</span><span class="st"> </span><span class="kw">median</span>(gm<span class="op">$</span>lifeExp[gm<span class="op">$</span>continent <span class="op">==</span><span class="st"> &quot;Americas&quot;</span>])
<span class="op">&gt;</span><span class="st"> </span><span class="kw">median</span>(gm<span class="op">$</span>lifeExp[gm<span class="op">$</span>continent <span class="op">==</span><span class="st"> &quot;Oceania&quot;</span>])</code></pre>
<p>The <code>group_by()</code> function makes this easier, and makes the output more useful.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>gm <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span><span class="kw">group_by</span>(continent) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span><span class="kw">summarize</span>(<span class="dt">medLifeExp =</span> <span class="kw">median</span>(lifeExp)) </code></pre>
<p>Or if we want the results ordered by the median life expectancy:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>gm <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span><span class="kw">group_by</span>(continent) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span><span class="kw">summarize</span>(<span class="dt">medLifeExp =</span> <span class="kw">median</span>(lifeExp)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span><span class="kw">arrange</span>(medLifeExp)</code></pre>
<p>As another example, we calculate the number of observations we have per continent (using the <code>n()</code> helper function), and then, among continents, how many distinct countries are represented (using <code>n_distinct()</code>).</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>gm <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span><span class="kw">group_by</span>(continent) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span><span class="kw">summarize</span>(<span class="dt">numObs =</span> <span class="kw">n</span>())
<span class="op">&gt;</span><span class="st"> </span>gm <span class="op">%&gt;%</span>
<span class="op">+</span><span class="st">   </span><span class="kw">group_by</span>(continent) <span class="op">%&gt;%</span>
<span class="op">+</span><span class="st">   </span><span class="kw">summarize</span>(<span class="dt">n_obs =</span> <span class="kw">n</span>(), <span class="dt">n_countries =</span> <span class="kw">n_distinct</span>(country))</code></pre>
<p>Here is a bit more involved example that calculates the minimum and maximum life expectancies for countries in Africa by year.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>gm <span class="op">%&gt;%</span>
<span class="op">+</span><span class="st">   </span><span class="kw">filter</span>(continent <span class="op">==</span><span class="st"> &quot;Africa&quot;</span>) <span class="op">%&gt;%</span>
<span class="op">+</span><span class="st">   </span><span class="kw">group_by</span>(year) <span class="op">%&gt;%</span>
<span class="op">+</span><span class="st">   </span><span class="kw">summarize</span>(<span class="dt">min_lifeExp =</span> <span class="kw">min</span>(lifeExp), <span class="dt">max_lifeExp =</span> <span class="kw">max</span>(lifeExp))</code></pre>
<p>This is interesting, but the results don’t include the countries that achieved the minimum and maximum life expectancies. Here is one way to achieve that. We will start with the minimum life expectancy. Note the rank of the minimum value will be 1.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>gm <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span>dplyr<span class="op">::</span><span class="kw">select</span>(country, continent, year, lifeExp) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span><span class="kw">group_by</span>(year) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span><span class="kw">arrange</span>(year) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span><span class="kw">filter</span>(<span class="kw">rank</span>(lifeExp) <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</code></pre>
<p>Next we add the maximum life expectancy. Here we need to better understand the <code>desc()</code> function, which will transform a vector into a numeric vector which will be sorted in descending order. Here are some examples.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span><span class="kw">desc</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)
<span class="op">&gt;</span><span class="st"> </span><span class="kw">desc</span>(<span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">-4</span>))
<span class="op">&gt;</span><span class="st"> </span><span class="kw">desc</span>(<span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;w&quot;</span>, <span class="st">&quot;e&quot;</span>))</code></pre>
<p>We now use this to extract the maximum life expectancy. Recall that <code>|</code> represents “or”. Also by default only the first few rows of a <code>tbl_df</code> object will be printed. To see all the rows we pipe the output to <code>print(n = 24)</code> to ask for all 24 rows to be printed.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>gm <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span>dplyr<span class="op">::</span><span class="kw">select</span>(country, continent, year, lifeExp) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span><span class="kw">group_by</span>(year) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span><span class="kw">arrange</span>(year) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span><span class="kw">filter</span>(<span class="kw">rank</span>(lifeExp) <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">|</span><span class="st"> </span><span class="kw">rank</span>(<span class="kw">desc</span>(lifeExp)) <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span><span class="kw">print</span>(<span class="dt">n=</span><span class="dv">24</span>)</code></pre>
</div>
<div id="creating-new-variables" class="section level3">
<h3><span class="header-section-number">6.7.8</span> Creating New Variables</h3>
<p>The <code>$</code> notation provides a simple way to create new variables in a data frame. The <code>mutate()</code> function provides another, sometimes cleaner way to do this. We will use <code>mutate()</code> along with the <code>lag()</code> function to investigate changes in life expectancy over five years for the <code>gapminder</code> data. We’ll do this in a few steps. First, we create a variable that measures the change in life expectancy and remove the population and GDP variables that are not of interest. We have to be careful to first group by country, since we want to calculate the change in life expectancy by country.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>gm <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span><span class="kw">mutate</span>(<span class="dt">changeLifeExp =</span> lifeExp <span class="op">-</span><span class="st"> </span><span class="kw">lag</span>(lifeExp, <span class="dt">order_by =</span> year)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(population, gdpPercap))</code></pre>
<p>Next, summarize by computing the largest drop in life expectancy.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>gm <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span><span class="kw">mutate</span>(<span class="dt">changeLifeExp =</span> lifeExp <span class="op">-</span><span class="st"> </span><span class="kw">lag</span>(lifeExp, <span class="dt">order_by =</span> year)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(population, gdpPercap)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span><span class="kw">summarize</span>(<span class="dt">largestDropLifeExp =</span> <span class="kw">min</span>(changeLifeExp))</code></pre>
<p>Oops. We forgot that since we don’t have data from before 1952, the first drop will be <code>NA</code>. Let’s try again.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>gm <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span><span class="kw">mutate</span>(<span class="dt">changeLifeExp =</span> lifeExp <span class="op">-</span><span class="st"> </span><span class="kw">lag</span>(lifeExp, <span class="dt">order_by =</span> year)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(population, gdpPercap)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span><span class="kw">summarize</span>(<span class="dt">largestDropLifeExp =</span> <span class="kw">min</span>(changeLifeExp, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</code></pre>
<p>That’s not quite what we wanted. We could arrange the results by the life expectancy drop, but it would be good to have both the continent and year printed out also. So we’ll take a slightly different approach, by arranging the results in increasing order.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>gm <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span><span class="kw">mutate</span>(<span class="dt">changeLifeExp =</span> lifeExp <span class="op">-</span><span class="st"> </span><span class="kw">lag</span>(lifeExp, <span class="dt">order_by =</span> year)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(population, gdpPercap)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span><span class="kw">arrange</span>(changeLifeExp)</code></pre>
<p>That’s still not quite right. Because the data are grouped by country, R did the ordering within group. If we want to see the largest drops overall, we need to remove the grouping.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span>gm <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">changeLifeExp =</span> lifeExp <span class="op">-</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span><span class="kw">lag</span>(lifeExp, <span class="dt">order_by =</span> year)) <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(population, 
<span class="op">+</span><span class="st">   </span>gdpPercap)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(changeLifeExp) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="op">+</span><span class="st">   </span><span class="kw">print</span>(<span class="dt">n =</span> <span class="dv">20</span>)</code></pre>
</div>
</div>
<div id="practice-exercises-3" class="section level2">
<h2><span class="header-section-number">6.8</span> Practice Exercises</h2>
<ol style="list-style-type: decimal">
<li>In Section <a href="data2.html#apply">6.3.2</a> we computed the standard deviation across all numeric columns using the following line of code:</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span><span class="kw">apply</span>(WeatherKLAN2014Full[, <span class="kw">c</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">19</span>, <span class="dv">21</span>, <span class="dv">23</span>)], <span class="dv">2</span>, sd)</code></pre>
<p>Notice the output value of <code>NA</code> for the column <code>Max.Gust.SpeedMPH</code>. Why does this happen? Figure out a way to make the <code>apply()</code> function return a numeric value for this column. <em>Hint</em>: check out the <code>sd()</code> definition.</p>
</div>
<div id="homework-3" class="section level2">
<h2><span class="header-section-number">6.9</span> Homework</h2>
<p><strong>Exercise 7</strong> Learning objectives: introduce <code>with()</code>, <code>tapply()</code>, and <code>cut()</code> functions; summarize data using the <code>table()</code> function with logical subsetting; practice using factor data types.</p>
<p><strong>Exercise 8</strong> Learning objectives: work with messy data; import data from an external spreadsheet; practice using functions in <code>tidyr</code> and <code>ggplot2</code>.}</p>
<p><strong>Exercise 9</strong> {Learning objectives: work with several key <strong>dplyr</strong> functions; manipulate data frames (actually tibbles); summarize and visualize data from large data files.}</p>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-SpectorDataManipulation">
<p>Spector, Phil. 2008. <em>Data Manipulation with R</em>. Use R! pub-sv:adr: pub-sv.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="27">
<li id="fn27"><p>These data come from the <code>MASS</code> R library.<a href="data2.html#fnref27" class="footnote-back">↩</a></p></li>
<li id="fn28"><p>Reminds me of <a href="https://en.wikipedia.org/wiki/The_Trouble_with_Tribbles">The Trouble with Tribbles</a><a href="data2.html#fnref28" class="footnote-back">↩</a></p></li>
<li id="fn29"><p>The text printed immediately after <code>library(dplyr)</code> means the <code>stats</code> and <code>base</code> packages, which are automatically loaded when you start R, have functions with the same name as functions in <code>dplyr</code>. So, for example, if you call the <code>filter()</code> or <code>lag()</code> functions, R will use <code>library(dplyr)</code>‘s functions. Use the <code>::</code> operator to explicity identify which packages’ function you want to use, e.g., if you want <code>stats</code>’s <code>lag()</code> then call <code>stats::lag()</code>.<a href="data2.html#fnref29" class="footnote-back">↩</a></p></li>
<li id="fn30"><p>Notice the indentation used in the code. This is not necessary, as the code could be all on one line, but I often find it easier to read in this more organized format<a href="data2.html#fnref30" class="footnote-back">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="graphics-in-r.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="functions-and-programming.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/yihui/bookdown-crc/edit/master/06-workingWithData.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["bookdown.pdf", "bookdown.epub"],
"toc": {
"collapse": "none"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
